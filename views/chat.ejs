<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat with <%= otherUser ? otherUser.name : "User" %></title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body class="bg-gray-900 text-white flex flex-col h-screen">

  <!-- Header -->
  <div class="bg-indigo-600 p-4 flex justify-between items-center">
    <div class="text-lg font-bold">
      Chat with <%= otherUser ? otherUser.name : "User" %>
    </div>
    <div class="flex gap-3">
      <!-- Audio Call -->
      <button class="bg-green-500 px-3 py-1 rounded hover:bg-green-400">ðŸ“ž</button>
      <!-- Video Call -->
      <button class="bg-blue-500 px-3 py-1 rounded hover:bg-blue-400">ðŸŽ¥</button>
    </div>
  </div>

  <!-- Messages -->
  <div id="messages" class="flex-1 overflow-y-auto p-4 space-y-3">
    <% if (messages && messages.length > 0) { %>
      <% messages.forEach(msg => { %>
        <div class="<%= msg.from.toString() === currentUser._id.toString() ? 'text-right' : 'text-left' %>">
          <div class="inline-block px-4 py-2 rounded-lg 
                      <%= msg.from.toString() === currentUser._id.toString() ? 'bg-indigo-500' : 'bg-gray-700' %>">
            <% if (msg.content) { %>
              <%= msg.content %>
            <% } else if (msg.image) { %>
              <img src="/uploads/<%= msg.image %>" alt="Image" class="max-w-xs rounded"/>
            <% } %>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <p class="text-center text-gray-400">No messages yet</p>
    <% } %>
  </div>

  <!-- Input Form -->
  <form method="POST" action="/message/<%= otherUser ? otherUser._id : '' %>" enctype="multipart/form-data" 
        class="p-4 bg-gray-800 flex gap-2 items-center">
    <input type="text" name="content" placeholder="Type a message..." 
           class="flex-1 px-3 py-2 rounded bg-gray-700 text-white" />
    <input type="file" name="image" accept="image/*" class="hidden" id="imageInput"/>
    <label for="imageInput" class="cursor-pointer bg-yellow-500 px-3 py-2 rounded">ðŸ“·</label>
    <button type="submit" class="bg-indigo-600 px-4 py-2 rounded">Send</button>
  </form>

</body>
</html>