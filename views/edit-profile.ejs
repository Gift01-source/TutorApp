<!DOCTYPE html>
<html>
<head>
  <title>Edit Profile - <%= profileuser.name %></title>
  <link rel="stylesheet" href="/css/style.css" />
</head>
  <script src="/js/location.js"></script>
  <script>
    document.querySelector('form').addEventListener('submit', function(e) {
      if (navigator.geolocation) {
        e.preventDefault();
        navigator.geolocation.getCurrentPosition(function(position) {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          fetch('/api/location', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ latitude: lat, longitude: lng })
          }).finally(() => {
            e.target.submit();
          });
        }, function() {
          e.target.submit();
        });
      }
    });
  </script>
</body>

  <form action="/profile/edit" method="POST" enctype="multipart/form-data">
    <label>Name:</label><br />
    <input type="text" name="name" value="<%= user.name %>" required /><br /><br />

    <label>Age:</label><br />
    <input type="number" name="age" value="<%= user.age || '' %>" /><br /><br />

    <label>Gender:</label><br />
    <select name="gender">
      <option value="" <%= !user.gender ? 'selected' : '' %>>Select Gender</option>
      <option value="Male" <%= user.gender === 'Male' ? 'selected' : '' %>>Male</option>
      <option value="Female" <%= user.gender === 'Female' ? 'selected' : '' %>>Female</option>
      <option value="Other" <%= user.gender === 'Other' ? 'selected' : '' %>>Other</option>
    </select><br /><br />

    <label>Bio:</label><br />
    <textarea name="bio" rows="4"><%= user.bio %></textarea><br /><br />

    <label>Interests (comma separated):</label><br />
    <input type="text" name="interests" value="<%= user.interests ? user.interests.join(', ') : '' %>" /><br /><br />

    <label>Profile Picture:</label><br />
    <input type="file" name="profilePicture" accept="image/*" /><br /><br />

    <button type="submit">Save Changes</button>
  </form>

  <a href="/profile">Cancel</a>
</body>
</html>